<!DOCTYPE html> 
<html lang="ja">

    <head>

        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Circle Checker" />
        <meta name="author" content="MizunagiKB" />

        <title id="id_title"></title>

        <link rel="stylesheet" href="jquery.mobile/jquery.mobile-1.4.5.min.css" />
    </head>

    <body>

        <div id="id_page_main" data-role="page">

            <div id="id_tpl_head" data-role="header" style="overflow:hidden;" data-theme="b">
                <div data-role="controlgroup" data-type="horizontal" class="ui-mini ui-btn-left">
                    <a id="id_menu_prev" class="ui-btn ui-btn-icon-notext ui-nodisc-icon ui-icon-carat-l" href="#">Prev</a>
                    <a id="id_menu_next" class="ui-btn ui-btn-icon-notext ui-nodisc-icon ui-icon-carat-r" href="#">Next</a>
                </div>
                <h1><a rel="external" href="{{EVENT_URL}}">{{EVENT_NAME}}</a></h1>
                <a id="id_menu_cfg" class="ui-btn-right ui-nodisc-icon" data-icon="gear" href="#">設定</a>
                <div data-role="navbar">
                    <ul>
                        <li><a id="id_menu_lst" class="ui-btn-top ui-nodisc-icon" data-icon="bullets" href="#">一覧</a></li>
                        <!-- <li><a id="id_menu_fnd" class="ui-btn-top ui-nodisc-icon" data-icon="search" href="#">検索</a></li> -->
                        <li><a id="id_menu_fav" class="ui-btn-top ui-nodisc-icon" data-icon="star" href="#">お気に入り<span id="id_head_fav_count" class="ui-li-count ui-body-b">0</span></a></li>
                    </ul>
                </div>
            </div>

            <div role="main" class="ui-content">
                <div id="id_view_lst">
                    <a class="ui-btn ui-btn-b ui-corner-all" data-theme="b" href="#id_view_mnu">配置&nbsp;<span id="id_layout_name"></span></a>
                    <div id="id_view_lst_tbl">
                    </div>
                </div>

                <div id="id_view_fnd">fnd</div>
                <div id="id_view_fav">
                    <table id="id_tbl_fav_0" class="table-stripe ui-responsive" data-role="table" data-mode="columntoggle">
                    </table>
                </div>
                <div id="id_view_cfg">
                    <form method="get" action="#">
                        <label for="src_url">URLから読込</label>
                        <input id="src_url" type="text" placeholder="" />
                        <button id="id_btn_import_src" type="button" data-theme="b">読込</button>
                    </form>
                    <a id="id_browser_type" rel="external" href="">通常版に変更</a>
                </div>
            </div>

            <div id="id_view_mnu" data-role="panel" data-position="left" data-display="reveal" data-theme="b">
            </div>

            <div id="id_tpl_desc" data-role="popup" data-overlay-theme="b" data-theme="b" data-dismissible="false">
                <div data-role="header" data-theme="a">
                    <h1>サークル情報</h1>
                </div>
                <div role="main" class="ui-content">
                    <h1>{{layout}}</h1>
                    {{{circle_table_item}}}
                    <a href="#" class="ui-btn ui-corner-all" data-rel="back" data-transition="fade">Close</a>
                </div>
            </div>

        </div>

        <script type="text/javascript">

            // ---------------------------------------------------- Global Object(s)
            var GLOBAL = new Object();

            GLOBAL.CIRCLE_DATA = null;
            GLOBAL.FAV = [];
            GLOBAL.TPL_FAV_LIST = [];
            GLOBAL.KEYWORD_DELAY = 15;
            GLOBAL.CURRENT_KEYWORD = "";
            GLOBAL.CURRENT_KEYWORD_DELAY = 0;

            // =====================================================================
            /*!
             */
            function get_url_param()
            {
                var listResult = [];
                var hashes = window.location.href.slice(window.location.href.indexOf("?") + 1).split("&");

                for(var n = 0; n < hashes.length; n++)
                {
                    var listData = hashes[n].split("=");

                    listResult.push(listData[0]);
                    listResult[listData[0]] = listData[1];
                }

                return(listResult);
            }

            // =====================================================================
            /*!
             */
            function sort_layout(objA, objB)
            {
                if(objA.layout > objB.layout) return(1);
                if(objA.layout < objB.layout) return(-1);

                return(0);
            }

            // =====================================================================
            /*!
             */
            function fav_search_idx(oCItem)
            {
                for(var n = 0; n < GLOBAL.FAV.length; n ++)
                {
                    if(oCItem.layout == GLOBAL.FAV[ n ].layout)
                    {
                        return(n);
                    }
                }

                return(-1);
            }

            function update_row_class(strId, strClass)
            {
                var oCRow = document.getElementById(strId);

                if(oCRow != null)
                {
                    oCRow.className = strClass;
                }

                return(oCRow)
            }

            // =====================================================================
            /*!
             */
            function fav_append(nGroup, nIndex)
            {
                var oCItem = GLOBAL.CIRCLE_DATA.CIRCLE_LIST_DAT[nGroup][nIndex];
                var nIdx = fav_search_idx(oCItem);

                if( nIdx == -1 )
                {
                    GLOBAL.FAV.push( oCItem );
                    GLOBAL.FAV.sort( sort_layout );

                    if(update_row_class("id_row_fnd_" + nGroup + "_" + nIndex, "info") != null)
                    {
                        $( "#id_btn_fnd_fav_add_" + nGroup + "_" + nIndex ).addClass( "disabled" );
                    }

                    if(update_row_class("id_row_lst_" + nGroup + "_" + nIndex, "info") != null)
                    {
                        $( "#id_btn_lst_fav_add_" + nGroup + "_" + nIndex ).addClass( "disabled" );
                    }

                    storage_save();

                    render_head();

                    render_fav();
                }
            }

            // =====================================================================
            /*!
             */
            function fav_remove( nGroup, nIndex )
            {
                var oCItem = GLOBAL.CIRCLE_DATA.CIRCLE_LIST_DAT[ nGroup ][ nIndex ];
                var nIdx = fav_search_idx( oCItem );


                if( nIdx != -1 )
                {
                    var oCRow = document.getElementById( "id_row_fav_" + nGroup + "_" + nIndex );

                    oCRow.parentNode.removeChild( oCRow );

                    if(update_row_class("id_row_fnd_" + nGroup + "_" + nIndex, "") != null)
                    {
                        $( "#id_btn_fnd_fav_add_" + nGroup + "_" + nIndex ).removeClass("disabled");
                    }

                    if(update_row_class("id_row_lst_" + nGroup + "_" + nIndex, "") != null)
                    {
                        $( "#id_btn_lst_fav_add_" + nGroup + "_" + nIndex ).removeClass("disabled");
                    }

                    GLOBAL.FAV.splice( nIdx, 1 );

                    storage_save();

                    render_head();
                }
            }

            // =====================================================================
            /*!
             */
            function show_layout( strId )
            {
                $("#id_view_mnu").panel("close");

                for(var n = 0; n < GLOBAL.CIRCLE_DATA.CIRCLE_LIST_TBL.length; n ++)
                {
                    $("#lst_" + n).hide();

                    if(strId == n)
                    {
                        $("#id_layout_name").text(GLOBAL.CIRCLE_DATA.CIRCLE_LIST_TBL[n].name);
                    }
                }

                $("#id_tbl_lst_" + strId).table().table("refresh");
                $("#lst_" + strId).show();
            }

            // =====================================================================
            /*!
             */
            function show_view( strId )
            {
                $( "#id_menu_lst" ).removeClass( "active" );
                $( "#id_menu_fnd" ).removeClass( "active" );
                $( "#id_menu_fav" ).removeClass( "active" );
                $( "#id_menu_cfg" ).removeClass( "active" );

                $( "#id_view_lst" ).hide();
                $( "#id_view_fnd" ).hide();
                $( "#id_view_fav" ).hide();
                $( "#id_view_cfg" ).hide();

                switch( strId )
                {
                    case "lst":
                    case "fnd":
                    case "fav":
                    case "cfg":
                        $( "#id_menu_" + strId ).addClass( "active" );
                        $( "#id_view_" + strId ).show();
                        break;

                    default:
                        break;
                }
            }

            // =====================================================================
            /*!
             */
            function import_from_url(strUrl)
            {
                $.getJSON(
                    strUrl,
                    function(oCJson)
                    {
                        GLOBAL.FAV = [];
                        GLOBAL.CIRCLE_DATA = oCJson;

                        init_appview(
                            GLOBAL.CIRCLE_DATA.CIRCLE_LIST_TBL
                        );

                        init_appdata(
                            GLOBAL.CIRCLE_DATA.CIRCLE_LIST_TBL,
                            GLOBAL.CIRCLE_DATA.CIRCLE_LIST_DAT
                        );

                        $("#id_title").text(GLOBAL.EVENT_NAME);

                        $("#id_browser_type").attr("href", "./index.html" + "?src_url=" + strUrl);

                        $("#id_tpl_head").html(GLOBAL.m_oCTplHead.render(GLOBAL.CIRCLE_DATA));

                        // データチェック用の関数を定義（ここでしか使用しないため、関数内で定義）
                        is_valid_param = function(param)
                        {
                            var bResult = false;
                            if(param)
                            {
                                if(param != "#")
                                {
                                    bResult = true;
                                }
                            }

                            return(bResult);
                        }

                        if(is_valid_param(GLOBAL.CIRCLE_DATA.DATA_SOURCE_PREV) == true)
                        {
                            $("#id_menu_prev").click(function(oCEvt){import_from_url(GLOBAL.CIRCLE_DATA.DATA_SOURCE_PREV);});
                        } else {
                            $("#id_menu_prev").click(function(oCEvt){$("#id_tpl_empty").modal("show");});
                        }

                        if(is_valid_param(GLOBAL.CIRCLE_DATA.DATA_SOURCE_NEXT) == true)
                        {
                            $("#id_menu_next").click(function(oCEvt){import_from_url(GLOBAL.CIRCLE_DATA.DATA_SOURCE_NEXT);});
                        } else {
                            $("#id_menu_next").click(function(oCEvt){$("#id_tpl_empty").modal("show");});
                        }

                        $("#id_menu_lst").click(function(oCEvt){show_view("lst");});
                        $("#id_menu_fnd").click(function(oCEvt){show_view("fnd");});
                        $("#id_menu_fav").click(function(oCEvt){show_view("fav");});
                        $("#id_menu_cfg").click(function(oCEvt){show_view("cfg");});

                        resume();

                        show_view("lst");

                        render_info();

                        render_fav();

                        $("#src_url").val(strUrl);

//                        setInterval(evt_keyword_timer, 100);
                    }
                );
            }

            // ===============================================================
            /*!
             */
            function search_keyword(strKeyword, oCItem)
            {
                var bFound = false;
                var listCItem;

                if(oCItem.circle_list)
                {
                    listCItem = oCItem.circle_list;
                } else {
                    listCItem = [oCItem];
                }

                for(var i = 0; i < listCItem.length; i ++)
                {
                    var oCItem = listCItem[i];

                    if(oCItem.circle)
                    {
                        if(oCItem.circle.indexOf(strKeyword, 0) != -1) bFound = true;
                    }

                    if(oCItem.writer)
                    {
                        if(oCItem.writer.indexOf(strKeyword, 0) != -1) bFound = true;
                    }
                }

                return(bFound);
            }

            // ===============================================================
            /*!
             */
            function evt_keyword_timer()
            {
                if(GLOBAL.CURRENT_KEYWORD_DELAY > 0)
                {
                    GLOBAL.CURRENT_KEYWORD_DELAY --;

                    var fProgress = (GLOBAL.KEYWORD_DELAY - GLOBAL.CURRENT_KEYWORD_DELAY) * 100;
                    fProgress /= GLOBAL.KEYWORD_DELAY;

                    $("#id_search_progress").css("width", fProgress + "%");

                    if(GLOBAL.CURRENT_KEYWORD_DELAY == 0)
                    {
                        var strKeyword = $("#keyword").val();
                        var oCTBL = GLOBAL.CIRCLE_DATA.CIRCLE_LIST_TBL;
                        var oCDAT = GLOBAL.CIRCLE_DATA.CIRCLE_LIST_DAT;
                        var nFoundCount = 0;
                        var listFavItem = [];
                        var listTable = [];

                        listTable.push('<tr><th>Check</th><th>配置</th><th>サークル名 / 執筆者</th><th>Info</th></tr>');

                        if(strKeyword)
                        {
                            for( var i = 0; i < oCTBL.length; i ++ )
                            {
                                for( var j = 0; j < oCDAT[ i ].length; j ++ )
                                {
                                    var oCItem = oCDAT[ i ][ j ];

                                    if(search_keyword(strKeyword, oCItem) == true)
                                    {
                                        var rowId = "id_row_fnd_" + oCItem.grp + "_" + oCItem.idx;

                                        listTable.push('<tr id="' + rowId + '">');
                                        for( var n = 0; n < GLOBAL.TPL_FND_LIST.length; n ++ )
                                        {
                                            listTable.push('<td>' + GLOBAL.TPL_FND_LIST[n].render(oCItem) + '</td>');
                                        }
                                        listTable.push('</tr>');

                                        var nIdx = fav_search_idx(oCItem);

                                        if(nIdx != -1)
                                        {
                                            listFavItem.push(oCItem);
                                        }

                                        nFoundCount += 1;
                                    }
                                }
                            }

                            $("#id_tbl_fnd_0").html(listTable.join(''));

                            for(var i = 0; i < listFavItem.length; i ++)
                            {
                                var oCItem = listFavItem[i];
                                var rowId = "id_row_fnd_" + oCItem.grp + "_" + oCItem.idx;

                                if(update_row_class(rowId, "info") != null)
                                {
                                    $("#id_btn_fnd_fav_add_" + oCItem.grp + "_" + oCItem.idx).addClass("disabled");
                                }
                            }
                        }

                        if(nFoundCount > 0)
                        {
                            $("#id_search_result").html(
                                '<p class="text-center">' + nFoundCount + ' 件 見つかりました。</p>'
                            );

                        } else {
                            $("#id_search_result").html(
                                '<p class="text-center">見つかりませんでした。</p>'
                            );
                        }

                    }
                }
            }

            // ===============================================================
            /*!
             */
            function evt_keyword(oCEvt)
            {
                if(oCEvt.keyCode == 0x0D)
                {
                    GLOBAL.CURRENT_KEYWORD_DELAY = GLOBAL.KEYWORD_DELAY;

                    $("#id_search_progress").css("width", "0%");
                }
            }

            // =====================================================================
            /*!
             */
            function evt_btn_search()
            {
                GLOBAL.CURRENT_KEYWORD_DELAY = GLOBAL.KEYWORD_DELAY;

                $("#id_search_progress").css("width", "0%");
            }

            // =====================================================================
            /*!
             */
            function evt_btn_fav_add( nGroup, nIndex )
            {
                fav_append( nGroup, nIndex );

                //console.log( "evt_btn_fav_add " + nGroup + ", " + nIndex );
            }

            // =====================================================================
            /*!
             */
            function evt_btn_fav_del(nGroup, nIndex)
            {
                fav_remove(nGroup, nIndex);

                //console.log( "evt_btn_fav_del " + nGroup + ", " + nIndex );
            }

            // =====================================================================
            /*!
             */
            function evt_btn_desc( nGroup, nIndex )
            {
                var oCItem = GLOBAL.CIRCLE_DATA.CIRCLE_LIST_DAT[ nGroup ][ nIndex ];

                var oCTpl = Hogan.compile(
                    ''
                    + '<table id="id_tpl_desc_tbl" class="table-stripe ui-responsive" data-role="table" data-mode="columntoggle">'
                    + '<thead>'
                        + '<tr class="ui-bar-d">'
                        + '<th>サークル名</th><th>執筆者</th>'
                        + '</tr>'
                    + '</thead>'
                    + '<tbody>'
                    + '{{#circle_list}}'
                    + '<tr>'
                    + '<td>'
                    + '<div>'
                    + '<span class="glyphicon glyphicon-{{#icon}}{{icon}}{{/icon}}{{^icon}}home{{/icon}}"></span>&nbsp;{{circle}}'
                    + '<br />'
                    + '{{#url}}<a href="{{url}}" target="_blank">{{/url}}{{url}}{{#url}}</a>{{/url}}'
                    + '</div>'
                    + '</td>'
                    + '<td><span class="glyphicon glyphicon-pencil"></span>&nbsp;{{writer}}</td>'
                    + '</tr>'
                    + '{{/circle_list}}'
                    + '{{^circle_list}}'
                    + '<tr>'
                    + '<td>'
                    + '<div>'
                    + '<span class="glyphicon glyphicon-{{#icon}}{{icon}}{{/icon}}{{^icon}}home{{/icon}}"></span>&nbsp;{{circle}}'
                    + '<br />'
                    + '{{#url}}<a href="{{url}}" target="_blank">{{/url}}{{url}}{{#url}}</a>{{/url}}'
                    + '</div>'
                    + '</td>'
                    + '<td><span class="glyphicon glyphicon-pencil"></span>&nbsp;{{writer}}</td>'
                    + '</tr>'
                    + '{{/circle_list}}'
                    + '</tbody>'
                    + '</table>'
                );

                $("#id_tpl_desc").html(
                    GLOBAL.m_oCTplDesc.render(
                        {
                            "layout": oCItem.layout,
                            "circle_table_item": oCTpl.render(oCItem)
                        }
                    )
                );

                $("#id_tpl_desc_tbl").table().table("refresh");

                $("#id_tpl_desc").popup().popup("open");

                //console.log( "evt_btn_desc " + nGroup + ", " + nIndex );
                //console.log( oCItem );
            }

            // =====================================================================
            /*!
             */
            function evt_btn_mark(nGroup, nIndex)
            {
                var oCItem = GLOBAL.CIRCLE_DATA.CIRCLE_LIST_DAT[nGroup][nIndex];

                var oCRow = document.getElementById("id_row_fav_" + nGroup + "_" + nIndex);

                if(oCRow.className != "")
                {
                    oCRow.className = "";
                } else {
                    oCRow.className = "success";
                }

                //console.log( "evt_btn_mark " + nGroup + ", " + nIndex );
            }

            // =====================================================================
            /*!
             */
            function evt_btn_import_url()
            {
                import_from_url($("#src_url").val());
            }

            // =====================================================================
            /*!
             */
            function render_head()
            {
                $("#id_head_fav_count").text(GLOBAL.FAV.length);

                //console.log( "GLOBAL.FAV.length " + GLOBAL.FAV.length );
            }

            // =====================================================================
            /*!
             */
            function render_info()
            {
                var strInfo = '';

                var oCTpl = Hogan.compile(
                ''
                + '<div class="alert alert-info alert-dismissable">'
                + '<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'
                + '<strong><span class="glyphicon glyphicon-info-sign"></span></strong>&nbsp;{{{text}}}'
                + '</div>'
                );
                var oCItem = GLOBAL.CIRCLE_DATA.INFORMATION;

                for( var n = 0; n < oCItem.length; n ++ )
                {
                  strInfo += oCTpl.render( oCItem[ n ] );
                }

                $( "#id_notify_area_1" ).html( strInfo );
            }

            // =====================================================================
            /*!
             */
            function render_fav()
            {
                var listTable = [];

                listTable.push(
                    ''
                    + '<thead>'
                    + '<tr><th>Check</th><th>配置</th><th>サークル名 / 執筆者</th><th>Info</th></tr>'
                    + '</thead>'
                );

                for( var i = 0; i < GLOBAL.FAV.length; i ++ )
                {
                    var oCItem = GLOBAL.FAV[ i ];

                    listTable.push('<tr id="id_row_fav_' + oCItem.grp + '_' + oCItem.idx + '">');

                    for( var n = 0; n < GLOBAL.TPL_FAV_LIST.length; n ++ )
                    {
                        listTable.push('<td>' + GLOBAL.TPL_FAV_LIST[n].render(oCItem) + '</td>');
                    }
                    listTable.push('</tr>')
                }

                $("#id_tbl_fav_0").html(listTable.join(''));
            }

            // =====================================================================
            /*!
             */
            function init_appview( oCListTbl )
            {
                var strUl_T = '';
                var strUl_V = '';
                var oCTpl_T = Hogan.compile( '<li><a href="#" onclick="show_layout({{id}})">{{name}}&nbsp;<span class="ui-li-count">0</span></a></li>' );
                var oCTpl_V = Hogan.compile(
                    ''
                    + '<div id="lst_{{id}}" style="display: none;">'
                    + '<table id="id_tbl_lst_{{id}}" class="table-stripe ui-responsive" data-role="table" data-mode="columntoggle">'
                    + '</table>'
                    + '</div>'
                );

                for(var n = 0; n < oCListTbl.length; n ++)
                {
                    strUl_T += oCTpl_T.render( oCListTbl[ n ] );
                    strUl_V += oCTpl_V.render( oCListTbl[ n ] );
                }

                $("#id_view_mnu").html(
                    ''
                    + '<ul id="id_view_mnu_ul" data-role="listview" data-inset="true">'
                    + '<li data-role="list-divider">配置</li>'
                    + strUl_T
                    + '</ul>'
                );

                $( "#id_view_lst_tbl" ).html(
                    ''
                    + strUl_V
                );
            }

            // =====================================================================
            /*!
             */
            function init_appdata( oCListTbl, oCListDat )
            {
                for( var i = 0; i < oCListTbl.length; i ++ )
                {
                    var listTable = [];

                    listTable.push(
                        ''
                        + '<thead>'
                        + '<tr>'
                        + '<th>Check</th>'
                        + '<th>配置</th>'
                        + '<th>サークル名 / 執筆者</th>'
                        + '<th>Info</th>'
                        + '</tr>'
                        + '</thead>'
                    );

                    listTable.push("<tbody>");

                    for( var j = 0; j < oCListDat[i].length; j ++ )
                    {
                        var oCItem = oCListDat[ i ][ j ];

                        oCItem.grp = i;
                        oCItem.idx = j;

                        listTable.push('<tr id="id_row_lst_' + oCItem.grp + '_' + oCItem.idx + '">');

                        for(var k = 0; k < GLOBAL.TPL_LST_LIST.length; k ++)
                        {
                            listTable.push('<td>' + GLOBAL.TPL_LST_LIST[k].render(oCItem) + '</td>');
                        }

                        listTable.push("</tr>");
                    }

                    listTable.push('</tbody>');

                    $("#id_tbl_lst_" + i).html(
                        listTable.join('')
                    );
                }

                $("#id_view_mnu_ul").listview().listview("refresh");

                show_layout(0);
            }

            // =====================================================================
            /*!
             */
            function storage_load()
            {
                if( !window.localStorage ) return;

                var listResult = [];
                var strStorageData = window.localStorage.getItem( GLOBAL.CIRCLE_DATA.DATA_SOURCE ) || -1;

                if( strStorageData != -1 )
                {
                    listResult = JSON.parse( strStorageData );
                }

                return( listResult );
            }

            // =====================================================================
            /*!
             */
            function storage_save()
            {
                if( !window.localStorage ) return;

                window.localStorage.setItem( GLOBAL.CIRCLE_DATA.DATA_SOURCE, JSON.stringify( GLOBAL.FAV ) );
            }

            // =====================================================================
            /*!
             */
            function resume()
            {
                if( !window.localStorage )
                {
                    document.getElementById( "id_notify_area_1" ).innerHTML = (
                        ''
                        + '<div class="alert alert-block">'
                        + '<button type="button" class="close" data-dismiss="alert">×</button>'
                        + '<h4>ご利用の環境ではローカルストレージが使用出来ないようです。</h4>ローカルストレージが使用出来ない場合、お気に入りを保存する事が出来ません。'
                        + '</div>'
                    );

                } else {

                    var listFav = storage_load();
                    var listTbl = GLOBAL.CIRCLE_DATA.CIRCLE_LIST_TBL;
                    var listDat = GLOBAL.CIRCLE_DATA.CIRCLE_LIST_DAT;

                    for( var grp = 0; grp < listTbl.length; grp ++ )
                    {
                        for( var idx = 0; idx < listDat[ grp ].length; idx ++ )
                        {
                            for( var n = 0; n < listFav.length; n ++ )
                            {
                                if( listDat[ grp ][ idx ].layout == listFav[ n ].layout )
                                {
                                    fav_append( grp, idx );
                                }
                            }
                        }
                    }
                }
            }

            // =====================================================================
            /*!
             */
            window.onload = function()
            {
                GLOBAL.m_oCTplHead = Hogan.compile($("#id_tpl_head").html());
                GLOBAL.m_oCTplDesc = Hogan.compile($("#id_tpl_desc").html());

                GLOBAL.TPL_LST_LIST = [
                    Hogan.compile( '<button id="id_btn_lst_fav_add_{{grp}}_{{idx}}" class="ui-btn ui-btn-icon-notext ui-corner-all ui-icon-star" onclick="evt_btn_fav_add({{grp}}, {{idx}});">x</button>' ),
                    Hogan.compile( '{{layout}}' ),
                    Hogan.compile(
                        ''
                        + '{{#circle_list}}'
                            + '<div>'
                            + '<span class="glyphicon glyphicon-{{#icon}}{{icon}}{{/icon}}{{^icon}}home{{/icon}}"></span>&nbsp;'
                            + '{{#url}}<a rel="external" href="{{url}}" target="_blank">{{/url}}{{circle}}{{#url}}</a>{{/url}}'
                            + '{{#writer}}<br />'
                            + '<span class="glyphicon glyphicon-pencil"></span>&nbsp;'
                            + '<small>{{writer}}</small>{{/writer}}'
                            + '</div>'
                        + '{{/circle_list}}'
                        + '{{^circle_list}}'
                            + '<div>'
                            + '<span class="glyphicon glyphicon-{{#icon}}{{icon}}{{/icon}}{{^icon}}home{{/icon}}"></span>&nbsp;'
                            + '{{#url}}<a rel="external" href="{{url}}" target="_blank">{{/url}}{{circle}}{{#url}}</a>{{/url}}'
                            + '{{#writer}}<br />'
                            + '<span class="glyphicon glyphicon-pencil"></span>&nbsp;'
                            + '<small>{{writer}}</small>{{/writer}}'
                            + '</div>'
                        + '{{/circle_list}}'
                    ),
                    Hogan.compile( '<button class="ui-btn ui-btn-icon-notext ui-corner-all ui-icon-info" onclick="evt_btn_desc({{grp}}, {{idx}});" >x</button>' )
                ];

                GLOBAL.TPL_FND_LIST = [
                    Hogan.compile( '<button id="id_btn_fnd_fav_add_{{grp}}_{{idx}}" class="btn btn-primary" onclick="evt_btn_fav_add({{grp}}, {{idx}});"><span class="glyphicon glyphicon-star"></span></button>' ),
                    Hogan.compile( '{{layout}}' ),
                    Hogan.compile(
                        ''
                        + '{{#circle_list}}'
                            + '<div>'
                            + '<span class="glyphicon glyphicon-{{#icon}}{{icon}}{{/icon}}{{^icon}}home{{/icon}}"></span>&nbsp;'
                            + '{{#url}}<a rel="external" href="{{url}}" target="_blank">{{/url}}{{circle}}{{#url}}</a>{{/url}}'
                            + '{{#writer}}<br />'
                            + '<span class="glyphicon glyphicon-pencil"></span>&nbsp;'
                            + '<small>{{writer}}</small>{{/writer}}'
                            + '</div>'
                        + '{{/circle_list}}'
                        + '{{^circle_list}}'
                            + '<div>'
                            + '<span class="glyphicon glyphicon-{{#icon}}{{icon}}{{/icon}}{{^icon}}home{{/icon}}"></span>&nbsp;'
                            + '{{#url}}<a rel="external" href="{{url}}" target="_blank">{{/url}}{{circle}}{{#url}}</a>{{/url}}'
                            + '{{#writer}}<br />'
                            + '<span class="glyphicon glyphicon-pencil"></span>&nbsp;'
                            + '<small>{{writer}}</small>{{/writer}}'
                            + '</div>'
                        + '{{/circle_list}}'
                    ),
                    Hogan.compile( '<button class="btn btn-default" onclick="evt_btn_desc({{grp}}, {{idx}});" ><span class="glyphicon glyphicon-info-sign"></span></button>' )
                ];

                GLOBAL.TPL_FAV_LIST = [
                    Hogan.compile( '<button id="id_btn_lst_fav_del_{{grp}}_{{idx}}" class="ui-btn ui-btn-icon-notext ui-corner-all ui-icon-delete" onclick="evt_btn_fav_del({{grp}}, {{idx}});">x</button>' ),
                    Hogan.compile( '{{layout}}' ),
                    Hogan.compile(
                        ''
                        + '{{#circle_list}}'
                            + '<div>'
                            + '<span class="glyphicon glyphicon-{{#icon}}{{icon}}{{/icon}}{{^icon}}home{{/icon}}"></span>&nbsp;'
                            + '{{#url}}<a rel="external" href="{{url}}" target="_blank">{{/url}}{{circle}}{{#url}}</a>{{/url}}'
                            + '{{#writer}}<br />'
                            + '<span class="glyphicon glyphicon-pencil"></span>&nbsp;'
                            + '<small>{{writer}}</small>{{/writer}}'
                            + '</div>'
                        + '{{/circle_list}}'
                        + '{{^circle_list}}'
                            + '<div>'
                            + '<span class="glyphicon glyphicon-{{#icon}}{{icon}}{{/icon}}{{^icon}}home{{/icon}}"></span>&nbsp;'
                            + '{{#url}}<a rel="external" href="{{url}}" target="_blank">{{/url}}{{circle}}{{#url}}</a>{{/url}}'
                            + '{{#writer}}<br />'
                            + '<span class="glyphicon glyphicon-pencil"></span>&nbsp;'
                            + '<small>{{writer}}</small>{{/writer}}'
                            + '</div>'
                        + '{{/circle_list}}'
                    ),
                    Hogan.compile(
                        ''
                        + '<div data-role="controlgroup" data-type="horizontal">'
                        + '<button class="ui-btn ui-btn-icon-notext ui-corner-all ui-icon-info" onclick="evt_btn_desc({{grp}}, {{idx}});" >x</button>'
                        + '<!-- <button class="ui-btn ui-btn-icon-notext ui-corner-all ui-icon-info" onclick="evt_btn_mark({{grp}}, {{idx}});" >x</button> -->'
                        + '</div>'
                    )
                ];

                show_view("cfg");

                // クリックイベントを設定
//                $("#id_btn_search").click(function(oCEvt){evt_btn_search();});
                $("#id_btn_import_src").click(function(oCEvt){evt_btn_import_url();});

//                $("#keyword").keyup(function(oCEvt){evt_keyword(oCEvt);});

                // エンターキーでフォーム送信されてしまうのを抑制。
                $("form").submit(function(){return(false)});

                listArgv = get_url_param();
                listArgv["src_url"] = "jsdata/lyricalmagical_18.json";
                //listArgv["src_url"] = "jsdata/sample.json.sample";

                if(listArgv["src_url"])
                {
                    if(listArgv["src_url"].length > 0)
                    {
                        import_from_url(listArgv["src_url"]);
                    }
                }
            }

        </script>

        <!-- jQuery-1.11.0 http://jquery.com/ -->
        <script type="text/javascript" src="jquery/js/jquery-1.11.0.min.js"></script>

        <!-- jQuery.mobile-1.4.5 http://jquerymobile.com/ -->
        <script type="text/javascript" src="jquery.mobile/jquery.mobile-1.4.5.min.js"></script>

        <!-- Hogan.js http://twitter.github.io/hogan.js/ -->
        <script type="text/javascript" src="hogan/js/hogan.min.js"></script>

    </body>
</html>
